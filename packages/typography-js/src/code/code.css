@layer pm.components {
  /* Inline code */
  .pm-code {
    --pm-code-bg: var(--pm-bg-muted);
    --pm-code-text: var(--pm-fg);
    --pm-code-border: var(--pm-border-muted);
    --pm-code-font-family: var(--pm-font-family-mono);

    font-family: var(--pm-code-font-family);
    font-size: 0.875em;
    background-color: var(--pm-code-bg);
    color: var(--pm-code-text);
    padding: 0.125em 0.375em;
    border-radius: var(--pm-radius-sm);
    white-space: nowrap;

    /* Sizes */
    &.pm-code--size-xs {
      font-size: var(--pm-font-size-xs);
    }

    &.pm-code--size-sm {
      font-size: var(--pm-font-size-sm);
    }

    &.pm-code--size-md {
      font-size: var(--pm-font-size-md);
    }

    &.pm-code--size-lg {
      font-size: var(--pm-font-size-lg);
    }

    /* Outline variant */
    &.pm-code--outline {
      background-color: transparent;
      border: 1px solid var(--pm-code-border);
    }

    /* Colors */
    &.pm-code--color-primary {
      --pm-code-bg: var(--pm-primary-subtle);
      --pm-code-text: var(--pm-fg-link-hover);
      --pm-code-border: var(--pm-primary-border);
    }

    &.pm-code--color-danger {
      --pm-code-bg: var(--pm-danger-subtle);
      --pm-code-text: var(--pm-danger-subtle-fg);
      --pm-code-border: var(--pm-danger-border);
    }

    &.pm-code--color-success {
      --pm-code-bg: var(--pm-success-subtle);
      --pm-code-text: var(--pm-success-subtle-fg);
      --pm-code-border: var(--pm-success-border);
    }

    &.pm-code--color-warning {
      --pm-code-bg: var(--pm-warning-subtle);
      --pm-code-text: var(--pm-warning-subtle-fg);
      --pm-code-border: var(--pm-warning-border);
    }

    &.pm-code--color-info {
      --pm-code-bg: var(--pm-info-subtle);
      --pm-code-text: var(--pm-info-subtle-fg);
      --pm-code-border: var(--pm-info-border);
    }

    &.pm-code--color-neutral {
      /* Uses default colors */
    }
  }

  /* Code block */
  .pm-code-block {
    --pm-code-block-bg: var(--pm-bg-muted);
    --pm-code-block-text: var(--pm-fg);
    --pm-code-block-border: var(--pm-border-muted);
    --pm-code-block-line-number-color: var(--pm-fg-subtle);

    display: block;
    font-family: var(--pm-font-family-mono);
    background-color: var(--pm-code-block-bg);
    color: var(--pm-code-block-text);
    padding: var(--pm-spacing-4);
    border-radius: var(--pm-radius-md);
    border: 1px solid var(--pm-code-block-border);
    overflow-x: auto;
    white-space: pre;
    line-height: var(--pm-font-lineHeight-relaxed);
    position: relative;
    tab-size: 2;

    /* Sizes */
    &.pm-code-block--size-xs {
      font-size: var(--pm-font-size-xs);
      padding: var(--pm-spacing-2) var(--pm-spacing-3);
    }

    &.pm-code-block--size-sm {
      font-size: var(--pm-font-size-sm);
      padding: var(--pm-spacing-3);
    }

    &.pm-code-block--size-md {
      font-size: var(--pm-font-size-md);
    }

    &.pm-code-block--size-lg {
      font-size: var(--pm-font-size-lg);
      padding: var(--pm-spacing-5);
    }

    /* Outline variant */
    &.pm-code-block--outline {
      background-color: transparent;
    }

    /* Colors */
    &.pm-code-block--color-primary {
      --pm-code-block-bg: var(--pm-primary-subtle);
      --pm-code-block-border: var(--pm-primary-border);
    }

    &.pm-code-block--color-danger {
      --pm-code-block-bg: var(--pm-danger-subtle);
      --pm-code-block-border: var(--pm-danger-border);
    }

    &.pm-code-block--color-success {
      --pm-code-block-bg: var(--pm-success-subtle);
      --pm-code-block-border: var(--pm-success-border);
    }

    &.pm-code-block--color-warning {
      --pm-code-block-bg: var(--pm-warning-subtle);
      --pm-code-block-border: var(--pm-warning-border);
    }

    &.pm-code-block--color-info {
      --pm-code-block-bg: var(--pm-info-subtle);
      --pm-code-block-border: var(--pm-info-border);
    }

    &.pm-code-block--color-neutral {
      /* Uses default colors */
    }

    /* Line numbers */
    &.pm-code-block--line-numbers {
      padding-left: calc(var(--pm-spacing-4) + 3em);
      counter-reset: line;

      & code {
        counter-increment: line;

        &::before {
          content: counter(line);
          display: inline-block;
          width: 2em;
          margin-left: -3em;
          margin-right: 1em;
          text-align: right;
          color: var(--pm-code-block-line-number-color);
          user-select: none;
        }
      }
    }

    /* Copy button slot */
    &.pm-code-block--copy {
      padding-right: calc(var(--pm-spacing-4) + 2.5rem);
    }

    /* Nested code element resets */
    & code {
      font-family: inherit;
      font-size: inherit;
      background-color: transparent;
      padding: 0;
      border-radius: 0;
      white-space: inherit;
      color: inherit;
    }
  }

  /* Theme overrides: Ant Design */
  .pm-theme-antd .pm-code {
    --pm-code-bg: light-dark(rgba(0, 0, 0, 0.03), rgba(255, 255, 255, 0.08));
    border: 1px solid light-dark(#d9d9d9, #434343);
    border-radius: 4px;
  }

  .pm-theme-antd .pm-code-block {
    --pm-code-block-bg: light-dark(rgba(0, 0, 0, 0.03), rgba(255, 255, 255, 0.08));
    --pm-code-block-border: light-dark(#d9d9d9, #434343);
    border-radius: 6px;
  }

  /* Theme overrides: Material */
  .pm-theme-material .pm-code {
    --pm-code-bg: light-dark(#f5f5f5, #2d2d2d);
    font-family: "Roboto Mono", monospace;
  }

  .pm-theme-material .pm-code-block {
    --pm-code-block-bg: light-dark(#f5f5f5, #2d2d2d);
    font-family: "Roboto Mono", monospace;
    border: none;
    box-shadow: var(--pm-shadow-sm);
  }

  /* Theme overrides: Bootstrap */
  .pm-theme-bootstrap .pm-code {
    --pm-code-bg: light-dark(#f8f9fa, #343a40);
    --pm-code-text: light-dark(#d63384, #e685b5);
    font-size: 0.875em;
  }

  .pm-theme-bootstrap .pm-code-block {
    --pm-code-block-bg: light-dark(#f8f9fa, #343a40);
    border: none;
  }

  /* Theme overrides: Dark Modern */
  .pm-theme-dark-modern .pm-code {
    --pm-code-bg: var(--pm-color-neutral-800);
    --pm-code-text: var(--pm-color-neutral-200);
  }

  .pm-theme-dark-modern .pm-code-block {
    --pm-code-block-bg: var(--pm-color-neutral-900);
    --pm-code-block-border: var(--pm-color-neutral-700);
    --pm-code-block-text: var(--pm-color-neutral-100);
  }

  /* Theme overrides: Light Modern */
  .pm-theme-light-modern .pm-code {
    --pm-code-bg: var(--pm-color-neutral-100);
    --pm-code-text: var(--pm-color-neutral-800);
  }

  .pm-theme-light-modern .pm-code-block {
    --pm-code-block-bg: var(--pm-color-neutral-50);
    --pm-code-block-border: var(--pm-color-neutral-200);
    --pm-code-block-text: var(--pm-color-neutral-800);
  }
}
